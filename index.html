<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kids Story Generator</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive;
      background-color: #f0f8ff;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      font-size: 16px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    .output {
      margin-top: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      min-height: 100px;
    }
    .loading {
      color: gray;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>Story Generator for Kids</h1>
  <textarea id="prompt" placeholder="Enter a story idea..."></textarea>
  <button onclick="generateStory()">Generate Story</button>
  <div class="output" id="result"></div>

  <script type="module">
    // Import WasmLlama from CDN
    import WasmLlama from 'https://cdn.jsdelivr.net/npm/@wllama/wllama@2.3.1/+esm';

    const modelPath = './models/TinyStories-LLaMA2-25M-256h-4l-GQA-Q5_K_M.gguf'; // Path to your GGUF model
    let llama;

    async function initModel() {
      if (!llama) {
        llama = new WasmLlama();
        await llama.load(modelPath);
      }
      return llama;
    }

    async function generateStory(prompt) {
      const model = await initModel();
      const response = await model.generate(prompt, {
        max_tokens: 150,
        temperature: 0.7,
        top_p: 0.9,
      });
      return response.text;
    }

    document.getElementById('prompt').addEventListener('input', () => {
      document.getElementById('result').innerText = '';
    });

    document.querySelector('button').addEventListener('click', async () => {
      const prompt = document.getElementById('prompt').value.trim();
      if (!prompt) return alert("Please enter a prompt.");

      const outputBox = document.getElementById('result');
      outputBox.innerHTML = '<div class="loading">Generating your story...</div>';

      try {
        const story = await generateStory(prompt);
        outputBox.innerText = story;
      } catch (error) {
        console.error(error);
        outputBox.innerText = "Something went wrong. Try again.";
      }
    });
  </script>
</body>
</html>